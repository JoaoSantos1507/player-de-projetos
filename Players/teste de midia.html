<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Player PDF Vertical</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
  <script>
    // Configuração essencial para a PDF.js encontrar seus arquivos de processamento
    pdfjsLib.GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js`;
  </script>

  <style>
    /* Estilos Globais e Reset (Idênticos ao player de referência) */
    html, body {
      margin: 0; padding: 0; background: black; overflow: hidden;
      width: 100vw; height: 100vh; font-family: 'Montserrat', sans-serif;
      display: flex; justify-content: center; align-items: center;
    }

    /* Estrutura Principal (Idêntica ao player de referência) */
    #player-wrapper {
      width: 1080px; height: 1920px;
      background: #1a1a1a;
      position: relative;
      box-shadow: 0 0 20px rgba(0,0,0,0.8);
      display: flex; flex-direction: column;
      justify-content: center; align-items: center;
      transform-origin: center center;
    }
    
    /* Container do Canvas do PDF */
    #pdf-container {
      width: 100%; height: 100%;
      position: relative;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    #pdf-canvas {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }

    /* Barra de Informações (Adaptada para PDF) */
    #barra {
      position: absolute; bottom: 20px; left: 50%;
      width: 95%;
      background: rgba(37, 37, 37, 0.93);
      display: flex;
      justify-content: space-between; align-items: center;
      padding: 15px 30px;
      font-size: 24px; font-weight: 600; color: #ffffff;
      z-index: 200;
      transform: translateX(-50%);
      border-radius: 12px;
      transition: all 0.3s ease;
    }
    #page-info {
        font-variant-numeric: tabular-nums;
    }
    
    /* Menu de Controles (Adaptado para PDF) */
    #controls-container {
      position: fixed; top: 50%; left: 50%;
      z-index: 300; display: none;
      transform: translate(-50%, -50%);
    }
    .menu-grid {
      list-style: none; margin: 0; padding: 0;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      border: 1px solid #4a4e69;
    }
    .menu-grid li { width: 160px; height: 130px; display: flex; justify-content: center; align-items: center; border: 1px solid #4a4e69; background-color: rgba(34, 34, 59, 0.95); cursor: pointer; transition: background-color 0.4s ease-in-out; }
    .menu-grid li:hover { background-color: #4a4e69; }
    .menu-grid li a { text-decoration: none; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #FFF; font-size: 16px; text-transform: capitalize; text-align: center; width: 100%; height: 100%; }
    .menu-grid li i { margin-bottom: 15px; }
  </style>
</head>
<body>

  <div id="player-wrapper">
    <div id="pdf-container">
      <canvas id="pdf-canvas"></canvas>
    </div>
    <div id="barra">
        <div id="file-name">Nenhum arquivo carregado</div>
        <div id="page-info">Página: - / -</div>
    </div>
  </div>

  <input type="file" id="pdfInput" accept="application/pdf" style="display: none;">

  <div id="controls-container">
    <ul class="menu-grid">
      <li><a href="#" onclick="selectFile()"><i class="fa fa-plus fa-2x"></i>Add PDF</a></li>
      <li><a href="#" id="play-pause-btn" onclick="togglePlayPause()"><i class="fa fa-pause fa-2x"></i>Pausar</a></li>
      <li><a href="#" onclick="prevPage()"><i class="fa fa-backward fa-2x"></i>Anterior</a></li>
      <li><a href="#" onclick="nextPage()"><i class="fa fa-forward fa-2x"></i>Próxima</a></li>
      
      <li><a href="#" onclick="changeInterval(-1000)"><i class="fa fa-minus-circle fa-2x"></i>Velocidade -</a></li>
      <li><a href="#" onclick="changeInterval(1000)"><i class="fa fa-plus-circle fa-2x"></i>Velocidade +</a></li>
      <li><a href="#" onclick="toggleBar()"><i class="fa fa-bars fa-2x"></i>Alternar Barra</a></li>
      <li><a href="#" onclick="toggleFullscreen()"><i class="fa fa-expand fa-2x"></i>Tela Cheia</a></li>

      <li><a href="#" onclick="zoomWrapperIn()"><i class="fa fa-search-plus fa-2x"></i>Zoom +</a></li>
      <li><a href="#" onclick="zoomWrapperOut()"><i class="fa fa-search-minus fa-2x"></i>Zoom -</a></li>
      <li><a href="#" onclick="rotateWrapper()"><i class="fa fa-redo fa-2x"></i>Rotacionar</a></li>
      <li><a href="#" onclick="resetTransforms()"><i class="fa fa-sync-alt fa-2x"></i>Resetar Posição</a></li>
    </ul>
  </div>

<script>
    // --- VARIÁVEIS GLOBAIS ---
    const wrapper = document.getElementById('player-wrapper');
    const pdfInput = document.getElementById('pdfInput');
    const controlsContainer = document.getElementById('controls-container');
    const barra = document.getElementById('barra');
    const fileNameEl = document.getElementById('file-name');
    const pageInfoEl = document.getElementById('page-info');
    const playPauseBtn = document.getElementById('play-pause-btn');

    // Variáveis de estado do PDF
    let pdfDoc = null;
    let currentPageNum = 1;
    let totalPages = 0;
    let slideInterval = null;
    let slideDuration = 5000; // 5 segundos por padrão
    let isPlaying = false;

    // Variáveis de transformação (mantidas do player original)
    let zoom = 1, rotation = 0, offsetX = 0, offsetY = 0;

    // --- FUNÇÕES DE CONTROLE GERAIS ---
    function toggleControls() { controlsContainer.style.display = (controlsContainer.style.display === 'block') ? 'none' : 'block'; }
    function toggleBar() { barra.style.display = (barra.style.display === 'none') ? 'flex' : 'none'; }
    function toggleFullscreen() { if (!document.fullscreenElement) document.documentElement.requestFullscreen(); else document.exitFullscreen(); }
    document.addEventListener('keydown', (e) => { if (e.key.toLowerCase() === 'm') { toggleControls(); } });
    
    // --- FUNÇÕES DE CARREGAMENTO DO PDF ---
    function selectFile() { pdfInput.click(); }
    pdfInput.onchange = (event) => {
        const file = event.target.files[0];
        if (file && file.type === 'application/pdf') {
            const fileReader = new FileReader();
            fileReader.onload = function() {
                const typedarray = new Uint8Array(this.result);
                loadPdf(typedarray, file.name);
            };
            fileReader.readAsArrayBuffer(file);
        }
    };

    function loadPdf(pdfData, fileName) {
        pdfjsLib.getDocument(pdfData).promise.then(doc => {
            pdfDoc = doc;
            totalPages = doc.numPages;
            currentPageNum = 1;
            fileNameEl.textContent = fileName;
            renderPage(currentPageNum);
            startLoop();
        }).catch(console.error);
    }

    function renderPage(num) {
        if (!pdfDoc) return;
        
        pdfDoc.getPage(num).then(page => {
            const canvas = document.getElementById('pdf-canvas');
            const ctx = canvas.getContext('2d');
            const desiredWidth = wrapper.clientWidth;
            const viewport = page.getViewport({ scale: 1 });
            const scale = desiredWidth / viewport.width;
            const scaledViewport = page.getViewport({ scale: scale });

            canvas.height = scaledViewport.height;
            canvas.width = scaledViewport.width;
            
            const renderContext = {
                canvasContext: ctx,
                viewport: scaledViewport
            };
            page.render(renderContext);
            
            pageInfoEl.textContent = `Página: ${num} / ${totalPages}`;
        });
    }

    // --- FUNÇÕES DE LOOP E NAVEGAÇÃO ---
    function startLoop() {
        if (slideInterval) clearInterval(slideInterval);
        isPlaying = true;
        playPauseBtn.innerHTML = '<i class="fa fa-pause fa-2x"></i>Pausar';
        slideInterval = setInterval(() => {
            nextPage(true); // O 'true' indica que a chamada veio do loop automático
        }, slideDuration);
    }

    function stopLoop() {
        clearInterval(slideInterval);
        isPlaying = false;
        playPauseBtn.innerHTML = '<i class="fa fa-play fa-2x"></i>Rodar';
    }
    
    function togglePlayPause() {
        if (!pdfDoc) return;
        if (isPlaying) {
            stopLoop();
        } else {
            startLoop();
        }
    }

    function nextPage(fromLoop = false) {
        if (!pdfDoc) return;
        currentPageNum++;
        if (currentPageNum > totalPages) {
            currentPageNum = 1; // Loop infinito
        }
        renderPage(currentPageNum);
        if (!fromLoop && isPlaying) { // Se o usuário clicar, reinicia o timer
            startLoop();
        }
    }

    function prevPage() {
        if (!pdfDoc) return;
        currentPageNum--;
        if (currentPageNum < 1) {
            currentPageNum = totalPages;
        }
        renderPage(currentPageNum);
        if (isPlaying) { // Reinicia o timer
             startLoop();
        }
    }

    function changeInterval(amount) {
        slideDuration += amount;
        if (slideDuration < 1000) slideDuration = 1000; // Mínimo de 1 segundo
        alert(`Intervalo alterado para ${slideDuration / 1000} segundos.`);
        if (isPlaying) {
            startLoop();
        }
    }

    // --- FUNÇÕES DE TRANSFORMAÇÃO (Idênticas ao player de referência) ---
    function updateWrapperTransform() {
        const transformValue = `translate(${offsetX}px, ${offsetY}px) rotate(${rotation}deg) scale(${zoom})`;
        wrapper.style.transform = transformValue;
    }
    function rotateWrapper() { rotation = (rotation + 90) % 360; updateWrapperTransform(); }
    function zoomWrapperIn() { zoom += 0.05; updateWrapperTransform(); }
    function zoomWrapperOut() { zoom = Math.max(0.1, zoom - 0.05); updateWrapperTransform(); }
    function resetTransforms() { zoom = 1; rotation = 0; offsetX = 0; offsetY = 0; updateWrapperTransform(); }

</script>
</body>
</html>
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Player Residencial</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@700&display=swap" rel="stylesheet">
  
  <style>
    /* Estilos Globais e Reset */
    html, body {
      margin: 0; padding: 0; background: black; overflow: hidden;
      width: 100vw; height: 100vh; font-family: 'Montserrat', sans-serif;
      display: flex; justify-content: center; align-items: center;
    }

    /* Estrutura Principal do Player Residencial */
    #player-wrapper {
      width: 1080px; 
      height: 1920px;
      background: white;
      position: relative;
      box-shadow: 0 0 20px rgba(0,0,0,0.8);
      display: flex; flex-direction: column;
      justify-content: space-between; align-items: center;
      -webkit-transform-origin: center center;
      transform-origin: center center;
    }
    #mediaWrapper {
      width: 100%; height: auto;
      aspect-ratio: 16 / 9;
      background: black;
      position: relative;
      overflow: hidden;
       /* Adicionado para transição suave */
      transition: aspect-ratio 0.4s ease-in-out;
    }
    #media, #fallback {
      width: 100%; height: 100%; object-fit: cover;
      position: absolute; top: 0; left: 0;
    }

    /* Caixa de Informações Central (Carrossel de Frases) */
   #infoBox {
  width: 90%;
  background: white; padding: 60px 30px;
  border: 12px solid #ff6600; color: black;
  text-align: center; font-size: 48px;
  margin-top: 83px; margin-bottom: 183px;
  flex-grow: 1; display: flex; flex-direction: column;
  justify-content: center; gap: 20px;
  position: relative;
  z-index: 10;
  -webkit-border-radius: 4px; border-radius: 4px;
}
    .frases {
      font-size: 60px; font-family: 'Barlow Condensed', sans-serif;
      font-weight: bold; color: black;
      height: 180px; display: flex;
      justify-content: center; align-items: center;
    }
    .frases span { display: none; }
    .frases span.active { display: block; width: 100%; text-align: center; }
    .marcadores {
      width: 92%; display: flex; justify-content: center; gap: 12px;
      position: absolute; bottom: -80px; left: 50%;
      z-index: 10;
      -webkit-transform: translateX(-50%);
      transform: translateX(-50%);
    }
    .marcador {
      height: 10px; flex-grow: 1; background: #ccc;
      -webkit-transition: background 0.3s ease;
      transition: background 0.3s ease;
      -webkit-border-radius: 6px;
      border-radius: 6px;
    }
    .marcador.active { background: #ff6600; }

    /* Barra de Informações Inferior */
    #barra {
      position: absolute; bottom: 12px; left: 50%;
      width: 95%; background: #ffffff;
      padding: 10px 20px; display: flex;
      justify-content: space-between; align-items: center;
      color: #111;
      z-index: 10;
      -webkit-transform: translateX(-50%);
      transform: translateX(-50%);
      -webkit-border-radius: 7px;
      border-radius: 7px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    #infoAlternada {
      display: flex; align-items: center; justify-content: flex-start;
      gap: 16px; flex: 1; font-size: 14px; font-weight: 500;
      transition: opacity 0.5s ease-in-out; /* Adicionado para efeito de fade */
    }
    /* NOVO: Estilo para o ícone na barra */
    .info-bar-icon {
        width: 22px;
        height: 22px;
        vertical-align: middle;
    }
    #barra .titulo { font-size: 11px; color: #666; text-transform: uppercase; font-weight: 600; }
    #barra .valor { color: #111; font-size: 18px; font-weight: bold; }
    #barra .marcador-cambio {
      font-size: 13px; font-weight: 600;
      padding: 2px 6px; color: white;
      -webkit-border-radius: 4px;
      border-radius: 4px;
    }
    #barra .marcador-cambio.positivo { background-color: #2ecc71; }
    #barra .marcador-cambio.negativo { background-color: #e74c3c; }
    .logo-relogio { display: flex; align-items: center; justify-content: flex-end; gap: 12px; font-size: 24px; font-weight: bold; color: #111; }
    .logo-relogio img { height: 34px; width: auto; }
    
    /* Estilos do Menu de Controles */
    #controls-container {
      position: fixed; top: 50%; left: 50%;
      z-index: 200; display: none;
      -webkit-transform: translate(-50%, -50%);
      transform: translate(-50%, -50%);
    }
    .menu-grid {
      list-style: none; margin: 0; padding: 0;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      border: 1px solid #4a4e69;
    }
    .menu-grid li {
      width: 160px; height: 130px; display: flex;
      justify-content: center; align-items: center;
      border: 1px solid #4a4e69;
      background-color: rgba(34, 34, 59, 0.95);
      cursor: pointer;
      -webkit-transition: background-color 0.4s ease-in-out;
      transition: background-color 0.4s ease-in-out;
    }
    .menu-grid li:hover { background-color: #4a4e69; }
    .menu-grid li a { text-decoration: none; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #FFF; font-size: 16px; text-transform: capitalize; text-align: center; width: 100%; height: 100%; }
    .menu-grid li i { margin-bottom: 15px; }
  </style>
</head>
<body>

  <div id="player-wrapper">
    <div id="mediaWrapper">
      <video id="media" autoplay muted loop playsinline></video>
      <img id="fallback" style="display: none;">
    </div>
    
    <div id="infoBox">
      <div class="frases">
        <span class="active" contenteditable="true" spellcheck="false"><h1>BEM VINDO</h1> A <br>ELETROMIDIA</span>
        <span contenteditable="true" spellcheck="false">BEM VINDO</span>
        <span contenteditable="true" spellcheck="false">BEM VINDO</span>
      </div>
      <div class="marcadores">
        <div class="marcador active"></div>
        <div class="marcador"></div>
        <div class="marcador"></div>
      </div>
    </div>
    
    <div id="barra">
        <div id="infoAlternada">Carregando...</div>
        <div class="logo-relogio">
            <img src="https://www.meioemensagem.com.br/wp-content/uploads/2021/08/eletrro3.png">
            <span id="hora"></span>
        </div>
    </div>
  </div>

  <input type="file" id="mediaInput" accept="video/mp4,image/*" multiple style="display: none;">

  <div id="controls-container">
    <ul class="menu-grid">
      <li><a href="#" onclick="addMedia()"><i class="fa fa-plus fa-2x"></i>Add Mídia</a></li>
      <li><a href="#" onclick="toggleFullscreen()"><i class="fa fa-expand fa-2x"></i>Tela Cheia</a></li>
      <li><a href="#" onclick="toggleBar()"><i class="fa fa-bars fa-2x"></i>Alternar Barra</a></li>
      <li><a href="#" onclick="resetMidias()"><i class="fa fa-trash fa-2x"></i>Resetar</a></li>
      <li><a href="#" onclick="toggleControls()"><i class="fa fa-eye-slash fa-2x"></i>Ocultar Menu</a></li>
      <li><a href="#" onclick="rotateWrapper()"><i class="fa fa-redo fa-2x"></i>Rotacionar</a></li>
      <li><a href="#" onclick="zoomWrapperIn()"><i class="fa fa-search-plus fa-2x"></i>Zoom +</a></li>
      <li><a href="#" onclick="zoomWrapperOut()"><i class="fa fa-search-minus fa-2x"></i>Zoom -</a></li>
      <li><a href="#" onclick="moveWrapper('up')"><i class="fa fa-arrow-up fa-2x"></i>Mover Cima</a></li>
      <li><a href="#" onclick="moveWrapper('down')"><i class="fa fa-arrow-down fa-2x"></i>Mover Baixo</a></li>
      <li><a href="#" onclick="moveWrapper('left')"><i class="fa fa-arrow-left fa-2x"></i>Mover Esq.</a></li>
      <li><a href="#" onclick="moveWrapper('right')"><i class="fa fa-arrow-right fa-2x"></i>Mover Dir.</a></li>
      <li><a href="#" onclick="stretchWrapper('horizontal+')"><i class="fa fa-arrows-alt-h fa-2x"></i>Largura +</a></li>
      <li><a href="#" onclick="stretchWrapper('vertical+')"><i class="fa fa-arrows-alt-v fa-2x"></i>Altura +</a></li>
      <li><a href="#" onclick="adjustMediaFit()"><i class="fa fa-compress-arrows-alt fa-2x"></i>Ajustar Mídia</a></li>
      <li><a href="#" onclick="return false;"><i class="fa fa-cog fa-2x"></i>Extra 2</a></li>
    </ul>
  </div>

  <script>
    // --- VARIÁVEIS GLOBAIS ---
    const wrapper = document.getElementById('player-wrapper');
    const media = document.getElementById('media');
    const mediaInput = document.getElementById('mediaInput');
    const controlsContainer = document.getElementById('controls-container');
    
    let mainPlaylist = [], mainIndex = 0;
    let zoom = 1, rotation = 270, offsetX = 0, offsetY = 0, scaleX = 1, scaleY = 1;

    // --- FUNÇÕES DE CONTROLE GERAIS ---
    function toggleControls() { controlsContainer.style.display = (controlsContainer.style.display === 'block') ? 'none' : 'block'; }
    function toggleBar() { document.getElementById('barra').style.display = (document.getElementById('barra').style.display === 'none') ? 'flex' : 'none'; }
    function toggleFullscreen() { if (!document.fullscreenElement) document.documentElement.requestFullscreen(); else document.exitFullscreen(); }
    function addMedia() { mediaInput.click(); }
    mediaInput.onchange = (event) => { const files = Array.from(event.target.files); mainPlaylist = mainPlaylist.concat(files); if (mainPlaylist.length === files.length) loadMainMedia(); }
    function loadMainMedia() { if (mainPlaylist.length === 0) return; const file = mainPlaylist[mainIndex]; const url = URL.createObjectURL(file); media.src = url; media.play(); }
    media.addEventListener('ended', () => { if (mainPlaylist.length > 0) { mainIndex = (mainIndex + 1) % mainPlaylist.length; loadMainMedia(); } });
    function resetMidias() { mainPlaylist = []; mainIndex = 0; media.pause(); media.removeAttribute('src'); media.load(); }
    document.addEventListener('keydown', (e) => { if (e.key.toLowerCase() === 'm') { toggleControls(); } });

    // --- FUNÇÕES DE TRANSFORMAÇÃO DO PLAYER ---
    function updateWrapperTransform() { const transformValue = `translate(${offsetX}px, ${offsetY}px) rotate(${rotation}deg) scale(${zoom * scaleX}, ${zoom * scaleY})`; wrapper.style.webkitTransform = transformValue; wrapper.style.transform = transformValue; }
    function rotateWrapper() { rotation = (rotation + 90) % 360; updateWrapperTransform(); }
    function zoomWrapperIn() { zoom += 0.1; updateWrapperTransform(); }
    function zoomWrapperOut() { zoom = Math.max(0.1, zoom - 0.1); updateWrapperTransform(); }
    function moveWrapper(direction) { if (direction === 'up') offsetY -= 10; if (direction === 'down') offsetY += 10; if (direction === 'left') offsetX -= 10; if (direction === 'right') offsetX += 10; updateWrapperTransform(); }
    function stretchWrapper(direction) { if (direction === 'horizontal+') scaleX += 0.05; if (direction === 'horizontal-') scaleX = Math.max(0.1, scaleX - 0.05); if (direction === 'vertical+') scaleY += 0.05; if (direction === 'vertical-') scaleY = Math.max(0.1, scaleY - 0.05); updateWrapperTransform(); }

    // ALTERAÇÃO 2: Nova função para ajustar o container da mídia
    function adjustMediaFit() {
      const mediaWrapper = document.getElementById('mediaWrapper');
      const videoEl = document.getElementById('media');

      // Se não houver vídeo carregado ou as dimensões não estiverem disponíveis, não faz nada
      if (!videoEl.src || videoEl.videoWidth === 0) {
        console.log("Mídia não carregada ou dimensões indisponíveis.");
        return;
      }
      
      // Verifica se um ajuste customizado já está ativo
      if (mediaWrapper.style.aspectRatio) {
        // Se estiver, remove o ajuste para voltar ao padrão (16/9 definido no CSS)
        mediaWrapper.style.aspectRatio = ''; 
      } else {
        // Se não estiver, calcula a proporção da mídia e aplica ao container
        const mediaAspectRatio = videoEl.videoWidth / videoEl.videoHeight;
        mediaWrapper.style.aspectRatio = mediaAspectRatio;
      }
    }

    // --- LÓGICA ESPECÍFICA DO PLAYER RESIDENCIAL ---
    function atualizarHora() { const horaEl = document.getElementById('hora'); if (!horaEl) return; const agora = new Date(); const h = agora.getHours().toString().padStart(2, '0'); const m = agora.getMinutes().toString().padStart(2, '0'); horaEl.textContent = `${h}:${m}`; }
    const carouselModule = {
      frases: document.querySelectorAll('.frases span'), marcadores: document.querySelectorAll('.marcadores .marcador'), fraseAtual: 0,
      start() { if (this.frases.length === 0) return; setInterval(() => { if(document.hidden) return; this.frases[this.fraseAtual].classList.remove('active'); this.marcadores[this.fraseAtual].classList.remove('active'); this.fraseAtual = (this.fraseAtual + 1) % this.frases.length; this.frases[this.fraseAtual].classList.add('active'); this.marcadores[this.fraseAtual].classList.add('active'); }, 5000); }
    };

    // LÓGICA ATUALIZADA DA BARRA DE INFORMAÇÕES
    const infoBarManager = {
        infoElement: document.getElementById('infoAlternada'),
        informacoes: [],
        currentIndex: 0,
        
        async fetchData() {
            try {
                const res = await fetch('https://economia.awesomeapi.com.br/last/USD-BRL,EUR-BRL');
                const data = await res.json();
                
                const usd = parseFloat(data.USDBRL.bid).toFixed(2);
                const usdChange = parseFloat(data.USDBRL.pctChange).toFixed(2);
                const dolarHtml = `<div style="display: flex; align-items: center; gap: 6px;">
                    <img src="https://cdn-icons-png.flaticon.com/512/3358/3358623.png" class="info-bar-icon" alt="ícone câmbio">
                    <span class="titulo">Dólar</span><span class="valor">R$ ${usd}</span>
                    <span class="marcador-cambio ${usdChange >= 0 ? 'positivo' : 'negativo'}">${usdChange >= 0 ? '+' : ''}${usdChange}%</span>
                </div>`;

                const eur = parseFloat(data.EURBRL.bid).toFixed(2);
                const eurChange = parseFloat(data.EURBRL.pctChange).toFixed(2);
                const euroHtml = `<div style="display: flex; align-items: center; gap: 6px;">
                    <img src="https://cdn-icons-png.flaticon.com/512/3358/3358623.png" class="info-bar-icon" alt="ícone câmbio">
                    <span class="titulo">Euro</span><span class="valor">R$ ${eur}</span>
                    <span class="marcador-cambio ${eurChange >= 0 ? 'positivo' : 'negativo'}">${eurChange >= 0 ? '+' : ''}${eurChange}%</span>
                </div>`;
                
                this.informacoes = [dolarHtml, euroHtml];
            } catch (e) {
                this.informacoes = [`<span style="color: red;">Erro de conexão</span>`];
                console.error("Erro ao buscar cotações:", e);
            }
        },
        
        cycleInfo() {
            if (this.informacoes.length === 0 || !this.infoElement) return;
            this.infoElement.style.opacity = 0;
            
            setTimeout(() => {
                this.infoElement.innerHTML = this.informacoes[this.currentIndex];
                this.infoElement.style.opacity = 1;
                this.currentIndex = (this.currentIndex + 1) % this.informacoes.length;
            }, 500);
        },

        async start() {
            await this.fetchData();
            this.cycleInfo();
            setInterval(() => this.cycleInfo(), 5000);
            setInterval(() => this.fetchData(), 300000);
        }
    };

    // --- INICIALIZAÇÃO PADRÃO ---
    function startPlayerLogic() {
        updateWrapperTransform(); 
        atualizarHora();
        setInterval(atualizarHora, 60000);
        carouselModule.start();
        infoBarManager.start();
    }

    // ========================================================================
    // --- BLOCO UNIVERSAL PARA CONTEÚDO DINÂMICO ---
    // ========================================================================
    document.addEventListener('DOMContentLoaded', () => {
        const dynamicContent = localStorage.getItem('dynamicContent');
        const dynamicFormat = localStorage.getItem('dynamicFormat');

        if (dynamicContent) {
            const mediaContainer = document.getElementById('mediaWrapper');
            if (mediaContainer) {
                const videoTag = mediaContainer.querySelector('video');
                const fallbackImg = mediaContainer.querySelector('#fallback');
                if (videoTag) videoTag.style.display = 'none';
                if (fallbackImg) fallbackImg.style.display = 'none';

                const contentWrapper = document.createElement('div');
                contentWrapper.style.cssText = 'position:absolute; top:0; left:0; width:100%; height:100%; z-index:1; overflow:hidden;';
                contentWrapper.innerHTML = dynamicContent;

                const overlay = document.createElement('div');
                overlay.style.cssText = 'position:absolute; top:0; left:0; width:100%; height:100%; z-index:2;';
                
                if (dynamicFormat === 'vertical' && !dynamicContent.includes('/shorts/')) {
                    const iframe = contentWrapper.querySelector('iframe');
                    if (iframe) {
                        iframe.style.width = '177.78vh';
                        iframe.style.height = '100vw';
                        iframe.style.position = 'absolute';
                        iframe.style.top = '50%';
                        iframe.style.left = '50%';
                        iframe.style.transform = 'translate(-50%, -50%) rotate(90deg)';
                    }
                }

                mediaContainer.appendChild(contentWrapper);
                mediaContainer.appendChild(overlay);
            }
            localStorage.removeItem('dynamicContent');
            localStorage.removeItem('dynamicFormat');
        }
        
        startPlayerLogic();
    });

        window.onload = function() {
        const content = localStorage.getItem('dynamicContent');
        const scriptSrc = localStorage.getItem('dynamicScript');
        const container = document.getElementById('media-container');

        if (content && container) {
            container.innerHTML = content;
            localStorage.removeItem('dynamicContent');

            if (scriptSrc) {
                const scriptTag = document.createElement('script');
                scriptTag.async = true;
                scriptTag.src = scriptSrc;
                document.body.appendChild(scriptTag);
                localStorage.removeItem('dynamicScript');
            }
        }
    };
</script>

</body>
</html>

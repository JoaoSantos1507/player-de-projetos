<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Player LED</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  
  <style>
    /* Estilos Globais e Reset */
    html, body {
      margin: 0; padding: 0; background: black; overflow: hidden;
      width: 100vw; height: 100vh; font-family: 'Montserrat', sans-serif;
    }

    /* Contêiner principal do Player LED */
    #player-container {
      position: absolute;
      top: 50%; left: 50%;
      width: 768px; height: 600px;
      background: #000;
      border: 2px solid #444;
      overflow: hidden; resize: both;
      display: flex; flex-direction: column;
      -webkit-transform: translate(-50%, -50%);
      transform: translate(-50%, -50%);
    }
    #mediaWrapper {
      flex-grow: 1; position: relative; background: #111;
      overflow: hidden;
    }
    #media, #fallback {
      width: 100%; height: 100%; object-fit: contain;
      position: absolute; top: 0; left: 0;
    }
    
    /* Barra Comercial (para o preset Coluna) */
    #barra-comercial {
        position: absolute;
        bottom: 2px;
        left: 2px;
        width: calc(100% - 4px);
        background: rgba(0,0,0,0.75);
        color: white;
        font-size: 14px;
        display: none;
        padding: 10px;
        box-sizing: border-box;
        justify-content: space-between;
        align-items: center;
        z-index: 10;
        border-radius: 26px; /* BORDAS ARREDONDADAS */
    }
    #barra-comercial #info-alternada { transition: opacity 0.5s ease; flex-grow: 1; }
    #barra-comercial #hora { font-size: 24px; font-weight: bold; }

    /* NOVO: Estilo do ícone igual ao Comercial.html */
    .icon-decorado {
        width: 20px;
        height: 20px;
        background: #ffffff;
        padding: 4px;
        border-radius: 6px;
        filter: brightness(0.50) invert(1);
        margin-right: 10px;
    }

    /* Relógio (para o preset Relógio) */
    #relogio-box {
        position: absolute; width: 100%;
        background: black; color: white;
        display: none; justify-content: center; align-items: center;
        font-size: 60px; font-weight: bold; z-index: 20;
    }
    .blink { animation: blink 1s step-start infinite; }
    @keyframes blink { 50% { opacity: 0; } }

    /* Estilos do Menu de Controles */
    #controls-container {
      position: fixed; top: 50%; left: 50%;
      z-index: 300; display: none;
      -webkit-transform: translate(-50%, -50%);
      transform: translate(-50%, -50%);
    }
    .menu-grid {
      list-style: none; margin: 0; padding: 0;
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      border: 1px solid #4a4e69;
    }
    .menu-grid li { width: 150px; height: 120px; display: flex; justify-content: center; align-items: center; border: 1px solid #4a4e69; background-color: rgba(34, 34, 59, 0.95); cursor: pointer; -webkit-transition: background-color 0.4s ease-in-out; transition: background-color 0.4s ease-in-out; }
    .menu-grid li:hover { background-color: #4a4e69; }
    .menu-grid li a { text-decoration: none; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #FFF; font-size: 14px; text-transform: capitalize; text-align: center; width: 100%; height: 100%; }
    .menu-grid li i { margin-bottom: 15px; }
    .menu-grid li a.active { background-color: #007bff; }
    
    #preset-livre-modal {
        display: none;
        position: fixed; top: 50%; left: 50%;
        -webkit-transform: translate(-50%, -50%);
        transform: translate(-50%, -50%);
        background-color: #22223b;
        color: white;
        padding: 30px;
        border: 1px solid #4a4e69;
        border-radius: 10px;
        box-shadow: 0 5px 25px rgba(0,0,0,0.5);
        z-index: 400;
        width: 300px;
    }
    #preset-livre-modal h3 { margin-top: 0; text-align: center; }
    .input-group { margin-bottom: 15px; }
    .input-group label { display: block; margin-bottom: 5px; }
    .input-group input { width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #4a4e69; background: #333; color: white; box-sizing: border-box; }
    .modal-botoes { text-align: right; }
    .modal-botoes button { background: #4a4e69; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; margin-left: 10px; }
    .modal-botoes button:hover { background: #5a5e79; }

    #selection-overlay {
        position: absolute;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background: rgba(0,0,0,0.5);
        cursor: crosshair;
        z-index: 50;
        display: none;
    }
    #selection-box {
        position: absolute;
        border: 2px dashed #fff;
        box-sizing: border-box;
    }

  </style>
</head>
<body>

  <div id="player-container">
    <div id="mediaWrapper">
      <video id="media" autoplay muted loop playsinline></video>
      <img id="fallback" style="display: none;" />
      <div id="selection-overlay">
        <div id="selection-box"></div>
      </div>
    </div>
    <div id="barra-comercial">
        <div id="info-alternada"></div>
        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTSngqZzv7e6QBJRAN9L8zXvB9deAVNWW6tXQ&s" alt="Logo" style="height:24px; margin-right:10px; vertical-align:middle;">
        <span id="hora"></span>
    </div>
  </div>
  
  <div id="relogio-box"></div>

  <input type="file" id="mediaInput" accept="video/mp4,image/*" multiple style="display: none;">

  <div id="preset-livre-modal">
    <h3>Preset Personalizado</h3>
    <div class="input-group">
        <label for="input-x">Posição X (px)</label>
        <input type="number" id="input-x" value="100">
    </div>
    <div class="input-group">
        <label for="input-y">Posição Y (px)</label>
        <input type="number" id="input-y" value="100">
    </div>
    <div class="input-group">
        <label for="input-largura">Largura (px)</label>
        <input type="number" id="input-largura" value="800">
    </div>
    <div class="input-group">
        <label for="input-altura">Altura (px)</label>
        <input type="number" id="input-altura" value="600">
    </div>
    <div class="modal-botoes">
        <button onclick="fecharModalPresetLivre()">Cancelar</button>
        <button onclick="aplicarPresetLivre()">Aplicar</button>
    </div>
  </div>

  <div id="controls-container">
    <ul class="menu-grid">
      <li><a href="#" onclick="addMedia()"><i class="fa fa-plus fa-2x"></i>Add Mídia</a></li>
      <li><a href="#" onclick="aplicarLayout('mub')"><i class="fa fa-desktop fa-2x"></i>Mub Premium</a></li>
      <li><a href="#" onclick="aplicarLayout('relogio')"><i class="fa fa-clock fa-2x"></i>Relógio</a></li>
      <li><a href="#" onclick="aplicarLayout('coluna')"><i class="fa fa-columns fa-2x"></i>Coluna</a></li>
      <li><a href="#" onclick="abrirModalPresetLivre()"><i class="fa fa-ruler-combined fa-2x"></i>Preset Livre</a></li>
      <li><a href="#" onclick="toggleBarraComercial()"><i class="fa fa-bars fa-2x"></i>Alternar Barra</a></li>
      <li><a href="#" onclick="toggleFullscreen()"><i class="fa fa-expand fa-2x"></i>Tela Cheia</a></li>
      <li><a href="#" onclick="resetMidias()"><i class="fa fa-trash fa-2x"></i>Resetar</a></li>
      <li id="move-button-li"><a href="#" onclick="toggleMover(this)"><i class="fa fa-arrows-alt fa-2x"></i>Ajustar Posição</a></li>
      <li><a href="#" onclick="toggleControls()"><i class="fa fa-eye-slash fa-2x"></i>Ocultar Menu</a></li>
      <li><a href="#" onclick="ajustarModo('contain', this)"><i class="fa fa-compress fa-2x"></i>Ajustar</a></li>
      <li><a href="#" onclick="ajustarModo('fill', this)"><i class="fa fa-expand-arrows-alt fa-2x"></i>Esticar</a></li>
      <li><a href="#" onclick="ajustarModo('cover', this)"><i class="fa fa-clone fa-2x"></i>Preencher</a></li>
      <li><a href="#" onclick="rotacionarMidia()"><i class="fa fa-redo fa-2x"></i>Rotacionar</a></li>
      <li><a href="#" onclick="resetarLayout()"><i class="fa fa-undo fa-2x"></i>Resetar Layout</a></li>
      <li><a href="#" onclick="salvarConfiguracao()"><i class="fa fa-save fa-2x"></i>Salvar</a></li>
      <li><a href="#" onclick="carregarConfiguracao()"><i class="fa fa-folder-open fa-2x"></i>Carregar</a></li>
      <li><a href="#" onclick="toggleCortar(this)"><i class="fa fa-crop-alt fa-2x"></i>Cortar Mídia</a></li>
    </ul>
  </div>

<script>
    // --- VARIÁVEIS GLOBAIS ---
    const playerContainer = document.getElementById('player-container');
    const media = document.getElementById('media');
    const fallback = document.getElementById('fallback');
    const mediaInput = document.getElementById('mediaInput');
    const controlsContainer = document.getElementById('controls-container');
    const barraComercial = document.getElementById('barra-comercial');
    const relogioBox = document.getElementById('relogio-box');
    const presetLivreModal = document.getElementById('preset-livre-modal');
    
    const selectionOverlay = document.getElementById('selection-overlay');
    const selectionBox = document.getElementById('selection-box');
    let cortarAtivo = false;
    let isSelecting = false;
    let startX, startY, startWidth, startHeight, startLeft, startTop;

    let mediaAtiva = media; let moverAtivo = false; let isDragging = false;
    let offsetX = 0, offsetY = 0; let rotacaoAtual = 0; let commercialBarInterval = null;

    // --- FUNÇÕES DE CONTROLE GERAIS ---
    function toggleControls() { controlsContainer.style.display = (controlsContainer.style.display === 'block') ? 'none' : 'block'; }
    function toggleFullscreen() { if (!document.fullscreenElement) document.documentElement.requestFullscreen(); else document.exitFullscreen(); }
    function toggleBarraComercial() { barraComercial.style.display = (barraComercial.style.display === 'flex') ? 'none' : 'flex'; }
    function addMedia() { mediaInput.click(); }
    mediaInput.onchange = (event) => { const file = event.target.files[0]; if (!file) return; const url = URL.createObjectURL(file); if (file.type.startsWith('video')) { fallback.style.display = 'none'; media.style.display = 'block'; media.src = url; media.play(); mediaAtiva = media; } else { media.style.display = 'none'; fallback.style.display = 'block'; fallback.src = url; mediaAtiva = fallback; } };
    function resetMidias() { media.pause(); media.removeAttribute('src'); fallback.removeAttribute('src'); media.load(); resetarCorte(); }
    document.addEventListener('keydown', (e) => { if (e.key.toLowerCase() === 'm') { toggleControls(); } });
    
    // --- FUNÇÕES ESPECÍFICAS DO PLAYER LED ---
    function toggleMover(element) { moverAtivo = !moverAtivo; playerContainer.style.cursor = moverAtivo ? 'move' : 'default'; element.classList.toggle('active', moverAtivo); }
    playerContainer.addEventListener('mousedown', (e) => { if (!moverAtivo) return; isDragging = true; offsetX = e.clientX - playerContainer.offsetLeft; offsetY = e.clientY - playerContainer.offsetTop; });
    document.addEventListener('mousemove', (e) => { if (isDragging && moverAtivo) { playerContainer.style.left = `${e.clientX - offsetX}px`; playerContainer.style.top = `${e.clientY - offsetY}px`; playerContainer.style.transform = `none`; } });
    document.addEventListener('mouseup', () => { isDragging = false; });
    
    function ajustarModo(modo, element) { 
        document.querySelectorAll('.menu-grid a[onclick*="ajustarModo"]').forEach(a => a.classList.remove('active')); 
        element.classList.add('active'); 
        resetarCorte();
        media.style.objectFit = modo; 
        fallback.style.objectFit = modo; 
    }
    
    function rotacionarMidia() { rotacaoAtual = (rotacaoAtual + 90) % 360; const transformValue = `rotate(${rotacaoAtual}deg)`; mediaAtiva.style.webkitTransform = transformValue; mediaAtiva.style.transform = transformValue; }
    
    function resetarLayout() { 
        barraComercial.style.display = 'none'; 
        relogioBox.style.display = 'none'; 
        if (commercialBarInterval) clearInterval(commercialBarInterval); 
        playerContainer.style.top = '50%'; 
        playerContainer.style.left = '50%'; 
        playerContainer.style.width = '768px'; 
        playerContainer.style.height = '600px'; 
        playerContainer.style.transform = 'translate(-50%, -50%)'; 
        resetarCorte();
    }

    function aplicarLayout(preset) {
        resetarLayout(); playerContainer.style.transform = 'none';
        if (preset === 'mub') { playerContainer.style.top = '0px'; playerContainer.style.left = '0px'; playerContainer.style.width = '960px'; playerContainer.style.height = '480px'; }
        else if (preset === 'relogio') { playerContainer.style.top = '0px'; playerContainer.style.left = '0px'; playerContainer.style.width = '280px'; playerContainer.style.height = '480px'; relogioBox.style.display = 'flex'; relogioBox.style.top = '480px'; relogioBox.style.left = '0px'; relogioBox.style.width = '280px'; relogioBox.style.height = '80px'; const updateClock = () => { relogioBox.innerHTML = new Date().toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'}).replace(':', '<span class="blink">:</span>'); }; updateClock(); commercialBarInterval = setInterval(updateClock, 1000); }
        else if (preset === 'coluna') {
            playerContainer.style.top = '0px'; playerContainer.style.left = '0px'; playerContainer.style.width = '768px'; playerContainer.style.height = '960px';
            barraComercial.style.display = 'flex';
            const informacoes = [ 
                // ÍCONE ATUALIZADO
                `<div style="display: flex; align-items: center; gap: 8px;"><img src='https://cdn-icons-png.flaticon.com/512/3358/3358623.png' class='icon-decorado' alt='Ícone Mercado'><span style="font-size: 10px; color: #ccc;">ÍNDICES</span><span>IBOV</span><span style="color: #2ecc71;">+0,4%</span><span style="background: #2ecc71; color: white; font-size: 9px; padding: 2px 4px; border-radius: 4px;">137.824</span></div>`, 
                // ÍCONE ATUALIZADO
                `<div style="display: flex; align-items: center; gap: 8px;"><img src='https://cdn-icons-png.flaticon.com/512/3358/3358623.png' class='icon-decorado' alt='Ícone Mercado'><span style="font-size: 10px; color: #ccc;">DÓLAR</span><span style="font-weight: bold;">R$ 5,45</span><span style="background-color: #e74c3c; color: white; font-size: 9px; padding: 2px 4px; border-radius: 4px;">-0.27%</span></div>` 
            ];
            let infoIndex = 0;
            const updateInfo = () => { const infoEl = document.getElementById('info-alternada'); infoEl.style.opacity = 0; setTimeout(() => { infoEl.innerHTML = informacoes[infoIndex]; infoEl.style.opacity = 1; infoIndex = (infoIndex + 1) % informacoes.length; }, 500); };
            const horaEl = document.getElementById('hora');
            const atualizarHora = () => { horaEl.textContent = new Date().toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'}); };
            atualizarHora(); updateInfo();
            commercialBarInterval = setInterval(() => { updateInfo(); atualizarHora(); }, 4000);
        }
    }
    function abrirModalPresetLivre() { controlsContainer.style.display = 'none'; presetLivreModal.style.display = 'block'; }
    function fecharModalPresetLivre() { presetLivreModal.style.display = 'none'; }
    function aplicarPresetLivre() { const x = document.getElementById('input-x').value; const y = document.getElementById('input-y').value; const largura = document.getElementById('input-largura').value; const altura = document.getElementById('input-altura').value; resetarLayout(); playerContainer.style.transform = 'none'; playerContainer.style.left = `${x}px`; playerContainer.style.top = `${y}px`; playerContainer.style.width = `${largura}px`; playerContainer.style.height = `${altura}px`; fecharModalPresetLivre(); }
    function salvarConfiguracao() { const config = { posicao: { top: playerContainer.style.top, left: playerContainer.style.left }, tamanho: { width: playerContainer.style.width, height: playerContainer.style.height }, transform: playerContainer.style.transform, modoAjuste: media.style.objectFit || 'contain', clipPath: mediaAtiva.style.clipPath || 'none' }; localStorage.setItem('configPlayerLED', JSON.stringify(config)); alert('Configuração salva!'); }
    function carregarConfiguracao() { const configStr = localStorage.getItem('configPlayerLED'); if (!configStr) { alert('Nenhuma configuração salva.'); return; } const config = JSON.parse(configStr); resetarLayout(); playerContainer.style.top = config.posicao.top; playerContainer.style.left = config.posicao.left; playerContainer.style.width = config.tamanho.width; playerContainer.style.height = config.tamanho.height; playerContainer.style.transform = config.transform; const modoBtn = document.querySelector(`.menu-grid a[onclick*="'${config.modoAjuste}'"]`); if (modoBtn) ajustarModo(config.modoAjuste, modoBtn); if (config.clipPath && config.clipPath !== 'none') { mediaAtiva.style.clipPath = config.clipPath; } alert('Configuração carregada!'); }
    
    function toggleCortar(element) {
        cortarAtivo = !cortarAtivo;
        element.classList.toggle('active', cortarAtivo);
        selectionOverlay.style.display = cortarAtivo ? 'block' : 'none';
        playerContainer.style.cursor = cortarAtivo ? 'crosshair' : 'default';
        if (moverAtivo) {
            toggleMover(document.querySelector('#move-button-li a'));
        }
    }
    
    function resetarCorte() {
        mediaAtiva.style.clipPath = '';
        mediaAtiva.style.transform = `rotate(${rotacaoAtual}deg)`;
        mediaAtiva.style.width = '100%';
        mediaAtiva.style.height = '100%';
        mediaAtiva.style.top = '0';
        mediaAtiva.style.left = '0';
        document.querySelector('.menu-grid a[onclick*="ajustarModo(\'contain\'"]').classList.add('active');
    }

    selectionOverlay.addEventListener('mousedown', (e) => {
        if (!cortarAtivo) return;
        e.preventDefault();
        isSelecting = true;
        startX = e.clientX - selectionOverlay.getBoundingClientRect().left;
        startY = e.clientY - selectionOverlay.getBoundingClientRect().top;
        selectionBox.style.left = `${startX}px`;
        selectionBox.style.top = `${startY}px`;
        selectionBox.style.width = '0px';
        selectionBox.style.height = '0px';
        selectionBox.style.display = 'block';
    });

    selectionOverlay.addEventListener('mousemove', (e) => {
        if (!isSelecting) return;
        const currentX = e.clientX - selectionOverlay.getBoundingClientRect().left;
        const currentY = e.clientY - selectionOverlay.getBoundingClientRect().top;
        const width = currentX - startX;
        const height = currentY - startY;

        selectionBox.style.width = `${Math.abs(width)}px`;
        selectionBox.style.height = `${Math.abs(height)}px`;
        selectionBox.style.left = `${width > 0 ? startX : currentX}px`;
        selectionBox.style.top = `${height > 0 ? startY : currentY}px`;
    });

    selectionOverlay.addEventListener('mouseup', (e) => {
        if (!isSelecting) return;
        isSelecting = false;
        selectionBox.style.display = 'none';
        
        const rect = {
            x: parseFloat(selectionBox.style.left),
            y: parseFloat(selectionBox.style.top),
            width: parseFloat(selectionBox.style.width),
            height: parseFloat(selectionBox.style.height)
        };

        if (rect.width > 0 && rect.height > 0) {
            const containerWidth = selectionOverlay.offsetWidth;
            const containerHeight = selectionOverlay.offsetHeight;

            const scaleX = containerWidth / rect.width;
            const scaleY = containerHeight / rect.height;

            const newWidth = mediaAtiva.offsetWidth * scaleX;
            const newHeight = mediaAtiva.offsetHeight * scaleY;

            const newLeft = -rect.x * scaleX;
            const newTop = -rect.y * scaleY;
            
            mediaAtiva.style.objectFit = 'cover';
            mediaAtiva.style.width = `${newWidth}px`;
            mediaAtiva.style.height = `${newHeight}px`;
            mediaAtiva.style.top = `${newTop}px`;
            mediaAtiva.style.left = `${newLeft}px`;

            toggleCortar(document.querySelector('.menu-grid a[onclick*="toggleCortar"]'));
        }
    });

    // --- INICIALIZAÇÃO PADRÃO ---
    function startPlayerLogic() {
        // O player LED não tem lógica que inicia sozinha.
    }

    // ========================================================================
    // --- BLOCO UNIVERSAL PARA CONTEÚDO DINÂMICO ---
    // ========================================================================
    document.addEventListener('DOMContentLoaded', () => {
        const dynamicContent = localStorage.getItem('dynamicContent');
        const dynamicFormat = localStorage.getItem('dynamicFormat');

        if (dynamicContent) {
            const mediaContainer = document.getElementById('mediaWrapper');
            if (mediaContainer) {
                const videoTag = mediaContainer.querySelector('video');
                const fallbackImg = mediaContainer.querySelector('#fallback');
                if (videoTag) videoTag.style.display = 'none';
                if (fallbackImg) fallbackImg.style.display = 'none';

                const contentWrapper = document.createElement('div');
                contentWrapper.style.cssText = 'position:absolute; top:0; left:0; width:100%; height:100%; z-index:1; overflow:hidden;';
                contentWrapper.innerHTML = dynamicContent;

                const overlay = document.createElement('div');
                overlay.style.cssText = 'position:absolute; top:0; left:0; width:100%; height:100%; z-index:2;';

                mediaContainer.appendChild(contentWrapper);
                mediaContainer.appendChild(overlay);
            }
            localStorage.removeItem('dynamicContent');
            localStorage.removeItem('dynamicFormat');
        }
        
        startPlayerLogic();
    });

        window.onload = function() {
        const content = localStorage.getItem('dynamicContent');
        const scriptSrc = localStorage.getItem('dynamicScript');
        const container = document.getElementById('media-container');

        if (content && container) {
            container.innerHTML = content;
            localStorage.removeItem('dynamicContent');

            if (scriptSrc) {
                const scriptTag = document.createElement('script');
                scriptTag.async = true;
                scriptTag.src = scriptSrc;
                document.body.appendChild(scriptTag);
                localStorage.removeItem('dynamicScript');
            }
        }
    };
</script>

</body>
</html>
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Player Vertical</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  
  <style>
    /* Estilos Globais e Reset */
    html, body {
      margin: 0; padding: 0; background: black; overflow: hidden;
      width: 100vw; height: 100vh; font-family: 'Montserrat', sans-serif;
      display: flex; justify-content: center; align-items: center;
    }

    /* Estrutura Principal */
    #player-wrapper {
      width: 1080px; height: 1920px;
      background: black;
      position: relative;
      box-shadow: 0 0 20px rgba(0,0,0,0.8);
      display: flex; flex-direction: column;
      justify-content: flex-end; align-items: center;
      -webkit-transform-origin: center center;
      transform-origin: center center;
    }
    #mediaWrapper {
      width: 100%; height: 100%;
      background: black;
      position: absolute; top:0; left:0;
      overflow: hidden;
    }
    #media, #fallback {
      width: 100%; height: 100%; object-fit: cover;
    }
    
    /* --- Estilos da #barra atualizados para o padrão do player Comercial --- */
    #barra {
      position: absolute; bottom: 97px; left: 50%;
      width: 97%; /* Mais larga */
      background: rgba(0, 0, 0, 0.75); /* Padrão Comercial */
      display: flex;
      justify-content: space-between; align-items: center;
      padding: 20px; /* Padrão Comercial */
      font-size: 20px; font-weight: 600; color: #ffffff;
      z-index: 200;
      -webkit-transform: translateX(-50%);
      transform: translateX(-50%);
      -webkit-border-radius: 26px; /* Padrão Comercial */
      border-radius: 26px; /* Padrão Comercial */
      -webkit-transition: all 0.3s ease;
      transition: all 0.3s ease;
      box-sizing: border-box; 
    }
    
    /* Container para agrupar nome do shopping e info alternada */
    #shopping-info-container {
        display: flex;
        align-items: center;
        flex-grow: 1; /* Ocupa o espaço disponível */
        overflow: hidden; /* Evita que o conteúdo vaze */
    }

    #shopping-nome { 
        white-space: nowrap; 
        overflow: hidden; 
        text-overflow: ellipsis; 
        flex-shrink: 0; 
        margin-right: 25px; /* Espaçamento entre o nome e a informação */
        font-size: 24px;
    }
    
    /* --- Classe para a logo, inspirada no player Comercial --- */
    .logo-eletromidia {
        height: 48px;
        max-width: 200px;
        object-fit: contain;
    }

    /* Ícone no estilo dos players comerciais */
    .icon-decorado {
        height: 30px !important;
        width: 30px !important;
        background: #ffffff;
        padding: 5px;
        border-radius: 50%;
        filter: brightness(0.50) invert(1);
        margin-right: 15px; /* Espaço entre ícone e texto */
        vertical-align: middle;
        flex-shrink: 0;
    }

    /* Marcadores de status (verde/vermelho) */
    .info-marker {
        font-size: 16px;
        font-weight: 700;
        padding: 4px 10px;
        color: white;
        border-radius: 5px;
        margin-left: 10px;
        flex-shrink: 0;
    }
    .info-marker.positivo { background-color: #2ecc71; }
    .info-marker.negativo { background-color: #e74c3c; }
    .info-marker.alerta { background-color: #f1c40f; }
    
    #shopping-info-alternada {
        display: flex; 
        align-items: center; 
        font-size: 20px;
        font-weight: 500;
        transition: opacity 0.5s ease;
        white-space: nowrap; 
        overflow: hidden;
        text-overflow: ellipsis;
    }

    /* Estilos do Menu de Controles */
    #controls-container {
      position: fixed; top: 50%; left: 50%;
      z-index: 300; display: none;
      -webkit-transform: translate(-50%, -50%);
      transform: translate(-50%, -50%);
    }
    .menu-grid {
      list-style: none; margin: 0; padding: 0;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      border: 1px solid #4a4e69;
    }
    .menu-grid li { width: 160px; height: 130px; display: flex; justify-content: center; align-items: center; border: 1px solid #4a4e69; background-color: rgba(34, 34, 59, 0.95); cursor: pointer; -webkit-transition: background-color 0.4s ease-in-out; transition: background-color 0.4s ease-in-out; }
    .menu-grid li:hover { background-color: #4a4e69; }
    .menu-grid li a { text-decoration: none; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #FFF; font-size: 16px; text-transform: capitalize; text-align: center; width: 100%; height: 100%; }
    .menu-grid li i { margin-bottom: 15px; }
  </style>
</head>
<body>

  <div id="player-wrapper">
    <div id="mediaWrapper">
      <video id="media" autoplay muted playsinline></video>
      <img id="fallback" style="display: none;" />
      <div id="barra">
      </div>
    </div>
  </div>

  <input type="file" id="mediaInput" accept="video/mp4,image/*" multiple style="display: none;">

  <div id="controls-container">
    <ul class="menu-grid">
      <li><a href="#" onclick="addMedia()"><i class="fa fa-plus fa-2x"></i>Add Mídia</a></li>
      <li><a href="#" onclick="reloadMidia()"><i class="fa fa-sync-alt fa-2x"></i>Recarregar</a></li>
      <li><a href="#" onclick="resetMidias()"><i class="fa fa-trash fa-2x"></i>Resetar</a></li>
      <li><a href="#" onclick="toggleControls()"><i class="fa fa-eye-slash fa-2x"></i>Ocultar Menu</a></li>
      
      <li><a href="#" onclick="ativarBarraShopping()"><i class="fa fa-store fa-2x"></i>Barra Shopping</a></li>
      <li><a href="#" onclick="ativarBarraComercial()"><i class="fa fa-chart-line fa-2x"></i>Barra Comercial</a></li>
      <li><a href="#" onclick="toggleBar()"><i class="fa fa-bars fa-2x"></i>Alternar Barra</a></li>
      <li><a href="#" onclick="toggleFullscreen()"><i class="fa fa-expand fa-2x"></i>Tela Cheia</a></li>

      <li><a href="#" onclick="ajustarAlturaBarra('up')"><i class="fa fa-chevron-up fa-2x"></i>Barra Cima</a></li>
      <li><a href="#" onclick="ajustarAlturaBarra('down')"><i class="fa fa-chevron-down fa-2x"></i>Barra Baixo</a></li>
      <li><a href="#" onclick="rotateWrapper()"><i class="fa fa-redo fa-2x"></i>Rotacionar</a></li>
      <li><a href="#" onclick="zoomWrapperIn()"><i class="fa fa-search-plus fa-2x"></i>Zoom +</a></li>

      <li><a href="#" onclick="zoomWrapperOut()"><i class="fa fa-search-minus fa-2x"></i>Zoom -</a></li>
      <li><a href="#" onclick="moveWrapper('up')"><i class="fa fa-arrow-up fa-2x"></i>Mover Cima</a></li>
      <li><a href="#" onclick="moveWrapper('down')"><i class="fa fa-arrow-down fa-2x"></i>Mover Baixo</a></li>
      <li><a href="#" onclick="moveWrapper('left')"><i class="fa fa-arrow-left fa-2x"></i>Mover Esq.</a></li>

      <li><a href="#" onclick="moveWrapper('right')"><i class="fa fa-arrow-right fa-2x"></i>Mover Dir.</a></li>
      <li><a href="#" onclick="stretchWrapper('horizontal+')"><i class="fa fa-arrows-alt-h fa-2x"></i>Largura +</a></li>
      <li><a href="#" onclick="stretchWrapper('horizontal-')"><i class="fa fa-compress-arrows-alt fa-2x"></i>Largura -</a></li>
      <li><a href="#" onclick="stretchWrapper('vertical-')"><i class="fa fa-compress-arrows-alt fa-2x"></i>Altura -</a></li>
    </ul>
  </div>

<script>
    // --- VARIÁVEIS GLOBAIS ---
    const wrapper = document.getElementById('player-wrapper');
    const media = document.getElementById('media');
    const fallback = document.getElementById('fallback');
    const mediaInput = document.getElementById('mediaInput');
    const controlsContainer = document.getElementById('controls-container');
    const barra = document.getElementById('barra');
    
    // --- NOVAS VARIÁVEIS PARA CONTROLE DA PLAYLIST ---
    const IMAGE_DURATION = 7000; // Duração de 7 segundos para cada imagem
    let imageTimeout = null;     // Para controlar o temporizador da imagem

    let mainPlaylist = [], mainIndex = 0;
    let zoom = 1, rotation = 0, offsetX = 0, offsetY = 0, scaleX = 1, scaleY = 1;
    let commercialBarInterval = null;

    // --- FUNÇÕES DE CONTROLE GERAIS ---
    function toggleControls() { controlsContainer.style.display = (controlsContainer.style.display === 'block') ? 'none' : 'block'; }
    function toggleBar() { barra.style.display = (barra.style.display === 'none') ? 'flex' : 'none'; }
    function toggleFullscreen() { if (!document.fullscreenElement) document.documentElement.requestFullscreen(); else document.exitFullscreen(); }
    
    function addMedia() { 
        mediaInput.click(); 
    }
    
    mediaInput.onchange = (event) => {
        const files = Array.from(event.target.files);
        const wasEmpty = mainPlaylist.length === 0; // Verifica se a playlist estava vazia
        mainPlaylist = mainPlaylist.concat(files);
        // Se a playlist estava vazia e agora tem arquivos, inicia a reprodução
        if (wasEmpty && mainPlaylist.length > 0) {
            loadMainMedia();
        }
    }

    // --- LÓGICA DE REPRODUÇÃO (CORRIGIDA) ---
    function loadMainMedia() {
        if (mainPlaylist.length === 0) return;

        // Limpa qualquer temporizador de imagem anterior para evitar bugs
        if (imageTimeout) clearTimeout(imageTimeout);

        const file = mainPlaylist[mainIndex];
        const url = URL.createObjectURL(file);

        if (file.type.startsWith('video')) {
            fallback.style.display = 'none';
            media.style.display = 'block';
            media.src = url;
            media.play().catch(e => console.error("Erro ao reproduzir vídeo:", e));
        } else { // Se for uma imagem
            media.style.display = 'none';
            fallback.style.display = 'block';
            fallback.src = url;
            // Inicia um temporizador para passar para a próxima mídia após IMAGE_DURATION
            imageTimeout = setTimeout(playNextMedia, IMAGE_DURATION);
        }
    }

    // --- NOVA FUNÇÃO PARA AVANÇAR A PLAYLIST ---
    // Centraliza a lógica de avançar para a próxima mídia, garantindo o loop
    function playNextMedia() {
        if (mainPlaylist.length > 0) {
            mainIndex = (mainIndex + 1) % mainPlaylist.length; // O operador % garante o loop infinito
            loadMainMedia();
        }
    }
    
    // O evento 'ended' do vídeo agora chama a função para avançar a playlist
    media.addEventListener('ended', playNextMedia);

    function reloadMidia() {
        if (mainPlaylist.length > 0) {
            mainIndex = 0;
            loadMainMedia();
        }
    }

    function resetMidias() {
        // Limpa também o temporizador ao resetar
        if (imageTimeout) clearTimeout(imageTimeout);
        mainPlaylist = [];
        mainIndex = 0;
        media.pause();
        media.removeAttribute('src');
        fallback.removeAttribute('src');
        media.load();
    }

    document.addEventListener('keydown', (e) => {
        if (e.key.toLowerCase() === 'm') {
            toggleControls();
        }
    });
    
    // --- FUNÇÕES DE TRANSFORMAÇÃO (Inalteradas) ---
    function updateWrapperTransform() { const transformValue = `translate(${offsetX}px, ${offsetY}px) rotate(${rotation}deg) scale(${scaleX * zoom}, ${scaleY * zoom})`; wrapper.style.webkitTransform = transformValue; wrapper.style.transform = transformValue; }
    function rotateWrapper() { rotation = (rotation + 90) % 360; updateWrapperTransform(); }
    function zoomWrapperIn() { zoom += 0.05; updateWrapperTransform(); }
    function zoomWrapperOut() { zoom = Math.max(0.1, zoom - 0.05); updateWrapperTransform(); }
    function moveWrapper(direction) { if (direction === 'up') offsetY -= 10; if (direction === 'down') offsetY += 10; if (direction === 'left') offsetX -= 10; if (direction === 'right') offsetX += 10; updateWrapperTransform(); }
    function stretchWrapper(direction) { if (direction === 'horizontal+') scaleX += 0.05; if (direction === 'horizontal-') scaleX = Math.max(0.1, scaleX - 0.05); if (direction === 'vertical+') scaleY += 0.05; if (direction === 'vertical-') scaleY = Math.max(0.1, scaleY - 0.05); updateWrapperTransform(); }

    // --- FUNÇÕES ESPECÍFICAS DO PLAYER VERTICAL (Inalteradas) ---
    function ajustarAlturaBarra(direcao) { const bottomAtual = parseInt(getComputedStyle(barra).bottom) || 0; const novoBottom = direcao === 'up' ? bottomAtual + 10 : bottomAtual - 10; barra.style.bottom = `${novoBottom}px`; }
    function atualizarHora() { const horaEl = document.getElementById('hora'); if(horaEl) { horaEl.textContent = new Date().toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'}); } }

    function ativarBarraShopping() {
        if (commercialBarInterval) clearInterval(commercialBarInterval);
        barra.innerHTML = `
            <div id="shopping-info-container">
                <div id="shopping-nome" contenteditable="true" spellcheck="false">Shopping Iguatemi</div>
                <div id="shopping-info-alternada"></div>
            </div>
            <img src="img/logo-branca.png" alt="Logo" class="logo-eletromidia" onerror="this.onerror=null; this.src='https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTSngqZzv7e6QBJRAN9L8zXvB9deAVNWW6tXQ&s';">
        `;
        const shoppingInformacoes = [
            `<span><img src="https://cdn-icons-png.flaticon.com/512/1163/1163661.png" class="icon-decorado" alt="ícone clima"> Clima <span class="info-marker alerta">23°C</span></span>`,
            `<span><img src="https://cdn-icons-png.flaticon.com/512/854/854878.png" class="icon-decorado" alt="ícone trânsito"> Trânsito <span class="info-marker positivo">Sem Lentidão</span></span>`,
            `<span><img src="https://cdn-icons-png.flaticon.com/512/3358/3358623.png" class="icon-decorado" alt="ícone câmbio"> Dólar <span class="info-marker negativo">R$5,45</span></span>`
        ];
        let infoIndex = 0;
        const updateShoppingInfo = () => {
            const infoEl = document.getElementById('shopping-info-alternada');
            if (infoEl) {
                infoEl.style.opacity = 0;
                setTimeout(() => {
                    infoEl.innerHTML = shoppingInformacoes[infoIndex];
                    infoEl.style.opacity = 1;
                    infoIndex = (infoIndex + 1) % shoppingInformacoes.length;
                }, 500);
            }
        };
        updateShoppingInfo();
        commercialBarInterval = setInterval(updateShoppingInfo, 4000);
    }

    function ativarBarraComercial() {
        if (commercialBarInterval) clearInterval(commercialBarInterval);
        barra.style.background = 'rgba(0, 0, 0, 0.75)'; barra.style.padding = '20px';
        const informacoes = [ `<div style="display: flex; align-items: center; gap: 8px;"><span style="font-size: 12px; color: #ccc; font-weight: 600;">ÍNDICES</span><span style="font-weight: 600;">IBOVESPA</span><span style="color: #2ecc71;">+0,40%</span><span style="background: #2ecc71; color: white; font-size: 11px; font-weight: 600; padding: 2px 6px; border-radius: 4px;">137.824</span></div>`, `<div style="display: flex; align-items: center; gap: 8px;"><span style="font-size: 12px; color: #ccc; font-weight: 600;">CRIPTO</span><span style="font-weight: 600;">BITCOIN</span><span style="font-size: 18px; font-weight: bold;">R$ 345.243</span><span style="background-color: #e74c3c; color: white; font-size: 11px; padding: 2px 6px; border-radius: 4px;">-1.88%</span></div>`, `<div style="display: flex; align-items: center; gap: 8px;"><span style="font-weight: 600;">LENTIDÃO</span><span>SÃO PAULO</span><span style="background: #2ecc71; color: white; padding: 2px 6px; border-radius: 4px; font-size: 11px;">22 km</span></div>`, `<span style="font-size: 12px; font-weight: 600;">EURO</span><span style="font-size: 20px; font-weight: bold;">R$ 6,41</span> | <span style="font-size: 12px; font-weight: 600;">DÓLAR</span><span style="font-size: 20px; font-weight: bold;">R$ 5,45</span>` ];
        let infoIndex = 0;
        const updateInfo = () => { const infoEl = barra.querySelector('#info-alternada'); if (infoEl) { infoEl.style.opacity = 0; setTimeout(() => { infoEl.innerHTML = informacoes[infoIndex]; infoEl.style.opacity = 1; infoIndex = (infoIndex + 1) % informacoes.length; }, 500); } };
        barra.innerHTML = `<div id="info-alternada" style="transition: opacity 0.5s ease; flex-grow: 1; font-size: 15px;"></div><div class="relogio" style="display: flex; align-items: center; gap: 30px; font-size: 36px;"><img src="https://eletromidia.com.br/wp-content/themes/eletromidia/assets/images/logo-eletromidia-horizontal.png" alt="Logo" style="height:40px;"><span id="hora"></span></div>`;
        atualizarHora(); setInterval(atualizarHora, 60000);
        updateInfo(); commercialBarInterval = setInterval(updateInfo, 4000);
    }
    
    // --- BLOCO UNIVERSAL PARA CONTEÚDO DINÂMICO (Inalterado) ---
    function startPlayerLogic() {
        ativarBarraShopping();
    }

    document.addEventListener('DOMContentLoaded', () => {
        const dynamicContent = localStorage.getItem('dynamicContent');
        const dynamicFormat = localStorage.getItem('dynamicFormat');

        if (dynamicContent) {
            const mediaContainer = document.getElementById('mediaWrapper');
            if (mediaContainer) {
                const videoTag = mediaContainer.querySelector('video');
                const fallbackImg = mediaContainer.querySelector('#fallback');
                if (videoTag) videoTag.style.display = 'none';
                if (fallbackImg) fallbackImg.style.display = 'none';

                const contentWrapper = document.createElement('div');
                contentWrapper.style.cssText = 'position:absolute; top:0; left:0; width:100%; height:100%; z-index:1; overflow:hidden;';
                contentWrapper.innerHTML = dynamicContent;

                const overlay = document.createElement('div');
                overlay.style.cssText = 'position:absolute; top:0; left:0; width:100%; height:100%; z-index:2;';

                if (dynamicFormat === 'vertical' && !dynamicContent.includes('shorts')) {
                    const iframe = contentWrapper.querySelector('iframe');
                    if (iframe) {
                        const aspectRatio = 9 / 16;
                        iframe.style.width = `calc(100vh * ${aspectRatio})`;
                        iframe.style.height = `100vh`;
                        iframe.style.position = 'absolute';
                        iframe.style.top = '50%';
                        iframe.style.left = '50%';
                        iframe.style.transform = 'translate(-50%, -50%)';
                    }
                }
                
                mediaContainer.appendChild(contentWrapper);
                mediaContainer.appendChild(overlay);
            }
            localStorage.removeItem('dynamicContent');
            localStorage.removeItem('dynamicFormat');
        }
        
        startPlayerLogic();
    });

    window.onload = function() {
        const content = localStorage.getItem('dynamicContent');
        const scriptSrc = localStorage.getItem('dynamicScript');
        const container = document.getElementById('media-container');

        if (content && container) {
            container.innerHTML = content;
            localStorage.removeItem('dynamicContent');

            if (scriptSrc) {
                const scriptTag = document.createElement('script');
                scriptTag.async = true;
                scriptTag.src = scriptSrc;
                document.body.appendChild(scriptTag);
                localStorage.removeItem('dynamicScript');
            }
        }
    };
</script>

</body>
</html>
